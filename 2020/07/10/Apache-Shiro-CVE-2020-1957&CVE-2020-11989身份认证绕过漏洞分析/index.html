<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="0x00 漏洞信息12345VUL &#x3D; [&quot;CVE-2020-1957&amp;CVE-2020-11989&quot;]VUL_NAME &#x3D; [&quot;Apahce Shiro权限绕过漏洞&quot;]TYPE &#x3D; [&quot;Permissions Bypass&quot;]DESCRIPTION &#x3D; &#39;&#39;&#39;2020年3月23号，Shiro开发者Brian Demers在用户社区发表帖子，提醒shiro用户进行安全更新，本次更新进行了三">
<meta property="og:type" content="article">
<meta property="og:title" content="Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析">
<meta property="og:url" content="http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="R17a&#39;s blog">
<meta property="og:description" content="0x00 漏洞信息12345VUL &#x3D; [&quot;CVE-2020-1957&amp;CVE-2020-11989&quot;]VUL_NAME &#x3D; [&quot;Apahce Shiro权限绕过漏洞&quot;]TYPE &#x3D; [&quot;Permissions Bypass&quot;]DESCRIPTION &#x3D; &#39;&#39;&#39;2020年3月23号，Shiro开发者Brian Demers在用户社区发表帖子，提醒shiro用户进行安全更新，本次更新进行了三">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713145444783.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713145727086.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713150325825.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713151229419.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713152726548.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713152826010.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713154205020.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713154233782.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713154421239.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713161043499.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714131644955.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714132604290.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714102608525.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714102956166.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200713223910948.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714133200908.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714133408631.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714133928022.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714134656016.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714151630406.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714152537290.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714153059523.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714153812174.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714205353393.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714205939671.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714211044556.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714211754168.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714215504718.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714234621778.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714235245592.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200714235743342.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200715000016874.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200715000707589.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200715001035983.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200715001526885.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200715001735002.png">
<meta property="og:image" content="http://yoursite.com/imgs/image-20200715002010255.png">
<meta property="article:published_time" content="2020-07-09T16:21:59.000Z">
<meta property="article:modified_time" content="2020-08-20T16:27:07.000Z">
<meta property="article:author" content="R17a">
<meta property="article:tag" content="Apache Shiro">
<meta property="article:tag" content="身份认证绕过">
<meta property="article:tag" content="CVE-2020-1957">
<meta property="article:tag" content="CVE-2020-11989">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/imgs/image-20200713145444783.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/download/">Download</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/07/20/WebLogic%E7%B3%BB%E5%88%97%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/07/08/F5-BIG-IP%20F5%20BIG-IP%20CVE-2020-5902%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&text=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&is_video=false&description=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析&body=Check out this article: http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&name=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&t=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-漏洞信息"><span class="toc-number">1.</span> <span class="toc-text">0x00 漏洞信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-漏洞复现"><span class="toc-number">2.</span> <span class="toc-text">0x01 漏洞复现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境搭建："><span class="toc-number">2.1.</span> <span class="toc-text">环境搭建：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞复现："><span class="toc-number">2.2.</span> <span class="toc-text">漏洞复现：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2020-1957"><span class="toc-number">2.2.1.</span> <span class="toc-text">CVE-2020-1957</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2020-11989"><span class="toc-number">2.2.2.</span> <span class="toc-text">CVE-2020-11989</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-漏洞分析"><span class="toc-number">3.</span> <span class="toc-text">0x02 漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器基础知识"><span class="toc-number">3.1.</span> <span class="toc-text">拦截器基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-1957分析"><span class="toc-number">3.2.</span> <span class="toc-text">CVE-2020-1957分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-11989分析"><span class="toc-number">3.3.</span> <span class="toc-text">CVE-2020-11989分析</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">R17a</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-07-09T16:21:59.000Z" itemprop="datePublished">2020-07-10</time>
        
        (Updated: <time datetime="2020-08-20T16:27:07.000Z" itemprop="dateModified">2020-08-21</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/JAVA%E5%AE%89%E5%85%A8/">JAVA安全</a> › <a class="category-link" href="/categories/JAVA%E5%AE%89%E5%85%A8/Apache-Shiro/">Apache Shiro</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Apache-Shiro/" rel="tag">Apache Shiro</a>, <a class="tag-link" href="/tags/CVE-2020-11989/" rel="tag">CVE-2020-11989</a>, <a class="tag-link" href="/tags/CVE-2020-1957/" rel="tag">CVE-2020-1957</a>, <a class="tag-link" href="/tags/%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87/" rel="tag">身份认证绕过</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="0x00-漏洞信息"><a href="#0x00-漏洞信息" class="headerlink" title="0x00 漏洞信息"></a>0x00 漏洞信息</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VUL = [<span class="string">"CVE-2020-1957&amp;CVE-2020-11989"</span>]</span><br><span class="line">VUL_NAME = [<span class="string">"Apahce Shiro权限绕过漏洞"</span>]</span><br><span class="line">TYPE = [<span class="string">"Permissions Bypass"</span>]</span><br><span class="line">DESCRIPTION = <span class="string">'''2020年3月23号，Shiro开发者Brian Demers在用户社区发表帖子，提醒shiro用户进行安全更新，本次更新进行了三个修复，其中就包括了对编号为CVE-2020-1957的Shrio授权绕过漏洞的修复。SHIRO-682的修复了spring框架下uri = uri + ‘/’ 绕过Shiro防护的问题。然后下面的描述则清晰得描述了造成改错误的原因。在Spring web项目中，请求URI /resource/menus和/resource/menus/ 都可以访问到服务器的资源。但在Shiro中的URL路径表达式pathPattern可以正确匹配/resource/menus，但不能正确匹配/resource/menus/，导致过滤链无法正确匹配，从而绕过Shiro的防护机制。'''</span></span><br><span class="line">IMPACT = [<span class="string">"Apahce Shiro &lt; 1.5.3"</span>]</span><br></pre></td></tr></table></figure>

<h2 id="0x01-漏洞复现"><a href="#0x01-漏洞复现" class="headerlink" title="0x01 漏洞复现"></a>0x01 漏洞复现</h2><h3 id="环境搭建："><a href="#环境搭建：" class="headerlink" title="环境搭建："></a>环境搭建：</h3><p>首先搭建漏洞环境。看了网上方法，利用Spring Boot + shiro搭建。</p>
<p>先看了大家都参考的博客 <a href="https://segmentfault.com/a/1190000019440231" target="_blank" rel="noopener">https://segmentfault.com/a/1190000019440231</a> ，发现自己其实创建Spring项目就看不懂，所以先向郭老师请教了下，远程协助我建了项目，又发了我一篇文章 <a href="https://developer.aliyun.com/article/695233" target="_blank" rel="noopener">https://developer.aliyun.com/article/695233</a> ，总算搞懂怎么创建了，感谢郭老师的耐心:heart:。</p>
<p>创建项目，new-project，进入界面，选择Spring Initializr，这里服务填写阿里的下载更快点 <a href="https://start.aliyun.com/" target="_blank" rel="noopener">https://start.aliyun.com/</a> ，点击next</p>
<p><img src="/imgs/image-20200713145444783.png" alt="image-20200713145444783"></p>
<p>填写、选择项目元数据，next</p>
<p><img src="/imgs/image-20200713145727086.png" alt="image-20200713145727086"></p>
<p>选择Spring Web依赖，点击next，选择项目目录点击finish即创建完成</p>
<p><img src="/imgs/image-20200713150325825.png" alt="image-20200713150325825"></p>
<p>等待下载完成，在pom.xml添加Shiro依赖，这里shiro版本我选的1.4.0，只要在1.5.2以下都可以</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建完成后，发现项目下自动生成三个文件：src/main/java-ShiroApplication.class程序入口；src/main/resources-配置文件-application.properties；src/test/java-ShiroApplicationTests.class测试程序</p>
<p><img src="/imgs/image-20200713151229419.png" alt="image-20200713151229419"></p>
<p>接下来配置shiro过滤规则</p>
<p>创建Realm，实现认证：</p>
<figure class="highlight java"><figcaption><span>MyRealm.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.debug.shiro.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        String username = (String) token.getPrincipal();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">"javaboy"</span>.equals(username)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnknownAccountException(<span class="string">"账户不存在!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(username, <span class="string">"123"</span>, getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置shiro：</p>
<figure class="highlight java"><figcaption><span>ShiroConfig.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.debug.shiro.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.debug.shiro.bean.MyRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">MyRealm <span class="title">myRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyRealm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    org.apache.shiro.mgt.<span class="function">SecurityManager <span class="title">securityManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager manager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        manager.setRealm(myRealm());</span><br><span class="line">        <span class="keyword">return</span> manager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        bean.setSecurityManager(securityManager());</span><br><span class="line">        bean.setLoginUrl(<span class="string">"/login"</span>);</span><br><span class="line">        bean.setSuccessUrl(<span class="string">"/index"</span>);</span><br><span class="line">        bean.setUnauthorizedUrl(<span class="string">"/unauthorizedurl"</span>);</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"/doLogin"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        map.put(<span class="string">"/guest/*"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        map.put(<span class="string">"/admin/*"</span>, <span class="string">"authc"</span>);</span><br><span class="line">        bean.setFilterChainDefinitionMap(map);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置LoginController：</p>
<figure class="highlight java"><figcaption><span>LoginController.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.debug.shiro.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/doLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doLogin</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            subject.login(<span class="keyword">new</span> UsernamePasswordToken(username, password));</span><br><span class="line">            System.out.println(<span class="string">"登录成功!"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"登录失败!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/guest/*"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">guest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"guest page"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/admin/index"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">admin</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"admin page"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String  <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"please login!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以开始运行</p>
<p><img src="/imgs/image-20200713152726548.png" alt="image-20200713152726548"></p>
<p>访问 <a href="http://localhost:8080/login" target="_blank" rel="noopener">http://localhost:8080/login</a></p>
<p><img src="/imgs/image-20200713152826010.png" alt="image-20200713152826010"></p>
<p>至此，环境搭建成功。</p>
<h3 id="漏洞复现："><a href="#漏洞复现：" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><h4 id="CVE-2020-1957"><a href="#CVE-2020-1957" class="headerlink" title="CVE-2020-1957"></a>CVE-2020-1957</h4><p>访问 <a href="http://localhost:8080/admin/index" target="_blank" rel="noopener">http://localhost:8080/admin/index</a> ，可以看到被拦截，需要登录</p>
<p><img src="/imgs/image-20200713154205020.png" alt="image-20200713154205020"></p>
<p>访问 <a href="http://localhost:8080/admin/index/" target="_blank" rel="noopener">http://localhost:8080/admin/index/</a> ，直接进入admin界面，无需登录</p>
<p><img src="/imgs/image-20200713154233782.png" alt="image-20200713154233782"></p>
<h4 id="CVE-2020-11989"><a href="#CVE-2020-11989" class="headerlink" title="CVE-2020-11989"></a>CVE-2020-11989</h4><p>访问 <a href="http://localhost:8080/;/admin/index" target="_blank" rel="noopener">http://localhost:8080/;/admin/index</a> ，绕过登录进入admin界面</p>
<p><img src="/imgs/image-20200713154421239.png" alt="image-20200713154421239"></p>
<h2 id="0x02-漏洞分析"><a href="#0x02-漏洞分析" class="headerlink" title="0x02 漏洞分析"></a>0x02 漏洞分析</h2><h3 id="拦截器基础知识"><a href="#拦截器基础知识" class="headerlink" title="拦截器基础知识"></a>拦截器基础知识</h3><p>在debug分析前，先学习下Shiro拦截器的规则： <a href="https://www.jianshu.com/p/3671b97aab3d" target="_blank" rel="noopener">https://www.jianshu.com/p/3671b97aab3d</a> </p>
<p>Shiro拦截器有11种，这里只简单看下anon和authc，anon不需要认证可以直接访问，对应上述的/guest/*和/dologin，authc需要认证才能访问，对应/admin/*。</p>
<p><img src="/imgs/image-20200713161043499.png" alt="image-20200713161043499"></p>
<p>文章中介绍了两种拦截器配置方法：INI文件文件配置和代码配置，复现例子中用的是代码配置。</p>
<p>拦截器规则通配符如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?：匹配一个字符</span><br><span class="line">*：匹配零个或多个字符</span><br><span class="line">**：匹配零个或多个路径</span><br></pre></td></tr></table></figure>

<p>CVE-2020-1957复现例子中用到的是/admin/*，只匹配了admin下的文件，不会匹配多个路径，可以复现成功，如果是/admin/**则复现失败，有一定的局限性；而CVE-2020-11989无论是/admin/*还是/admin/**都可以复现成功。</p>
<h3 id="CVE-2020-1957分析"><a href="#CVE-2020-1957分析" class="headerlink" title="CVE-2020-1957分析"></a>CVE-2020-1957分析</h3><p>根据commit信息 <a href="https://github.com/apache/shiro/commit/3708d7907016bf2fa12691dff6ff0def1249b8ce" target="_blank" rel="noopener">https://github.com/apache/shiro/commit/3708d7907016bf2fa12691dff6ff0def1249b8ce</a> ，对WebUtils#getPathWithinApplication等进行了修复</p>
<p><img src="/imgs/image-20200714131644955.png" alt="image-20200714131644955"></p>
<p>所以我们在org.apache.shiro.web.util.WebUtils#getPathWithinApplication:48行打断点，开始debug模式，然后访问 <a href="http://127.0.0.1:8080/admin/index/" target="_blank" rel="noopener">http://127.0.0.1:8080/admin/index/</a> 开始分析</p>
<p>F8执行到String requestUri = getRequestUri(request) 然后继续执行</p>
<p><img src="/imgs/image-20200714132604290.png" alt="image-20200714132604290"></p>
<p>一直F8直到获取URI，getRequestUri(request) 返回的uri是我们输入的请求：/admin/index/</p>
<p><img src="/imgs/image-20200714102608525.png" alt="image-20200714102608525"></p>
<p>继续F8进入getPathWithinApplication(HttpServletRequest request)，返回/admin/index/</p>
<p><img src="/imgs/image-20200714102956166.png" alt="image-20200714102956166"></p>
<p>继续F8进入PathMatchingFilterChainResolver#getChain，拿到了刚刚getPathWithinApplication获取的请求URI-/admin/index/，将请求的URI链匹配配置的过滤规则链</p>
<p><img src="/imgs/image-20200713223910948.png" alt="image-20200713223910948"></p>
<p>执行到while条件时，F7进入pathMatches</p>
<p><img src="/imgs/image-20200714133200908.png" alt="image-20200714133200908"></p>
<p>pathMatches收到两个参数，pattern和path，一个是设置的规则链，一个是请求的路径，return pathMatcher.matches(pattern, path)我们F7进入pathMatcher.matches</p>
<p><img src="/imgs/image-20200714133408631.png" alt="image-20200714133408631"></p>
<p>此时进入到了org.apache.shiro.util.AntPathMatcher#matches，继续深入，会调用doMatch</p>
<p><img src="/imgs/image-20200714133928022.png" alt="image-20200714133928022"></p>
<p>分析doMatch，主要是用来匹配规则链和请求</p>
<p><img src="/imgs/image-20200714134656016.png" alt="image-20200714134656016"></p>
<p>继续执行，一直while循环到/admin/*和/admin/index/进行比较再来看下。分解路径时，是以”/“来进行分解，/admin/index/分解后的是{“admin”,”index”}，<strong>这里是和/admin/index分解后的结果一样</strong>，继续往下进入循环，第一个字符串相比较都是admin肯定一样，继续循环比较第二个*和index，调用matchStrings方法</p>
<p><img src="/imgs/image-20200714151630406.png" alt="image-20200714151630406"></p>
<p>F7看下matchStrings，比较*和index。循环比较每个字符，当字符为*，说明规则包含*，退出比较，返回true，匹配成功</p>
<p><img src="/imgs/image-20200714152537290.png" alt="image-20200714152537290"></p>
<p>继续回到doMatch，循环结束，此时返回pattern.endsWith(this.pathSeparator) ? path.endsWith(this.pathSeparator) : !path.endsWith(this.pathSeparator)，pattern.endsWith(this.pathSeparator) ，规则链/admin/*不是以分隔符/结尾，所以返回!path.endsWith(this.pathSeparator)，/admin/index/是以分隔符/结尾，所以为true，最终返回false，没有匹配到规则链。假设本来请求的是/admin/index，不以/结尾，这里最终会返回true，成功匹配到规则链</p>
<p><img src="/imgs/image-20200714153059523.png" alt="image-20200714153059523"></p>
<p>回到getChain，因为返回结果为false即没有匹配成功，所以while会继续循环，直到迭代完成，返回null。这里假如是请求/admin/index，匹配到了，会执行 filterChainManager.proxy(originalChain, pathPattern)，也就会进行代理。但是这里直接返回null没有执行proxy从而绕过了鉴权。</p>
<p><img src="/imgs/image-20200714153812174.png" alt="image-20200714153812174"></p>
<p>接下来继续分析如何获取到/admin/index的资源</p>
<p>F8到getMatchingPattern调用org.springframework.util.AntPathMatcher#match，然后doMatch</p>
<p><img src="/imgs/image-20200714205353393.png" alt="image-20200714205353393"></p>
<p>深入分析doMatch，可以看到跟之前类似，都是用/直接分解路径，然后依次比较，由于一个是以/结尾 一个不是，所以最终返回了false</p>
<p><img src="/imgs/image-20200714205939671.png" alt="image-20200714205939671"></p>
<p>getMatchingPattern(“/admin/index”, “/admin/index/“)返回/admin/index/</p>
<p><img src="/imgs/image-20200714211044556.png" alt="image-20200714211044556"></p>
<p>getMatchingPatterns返回matches={“/admin/index/“}</p>
<p><img src="/imgs/image-20200714211754168.png" alt="image-20200714211754168"></p>
<p>继续F8，返回到AbstractHandlerMethodMapping#addMatchingMappings，match=”/admin/index/“，因为match不为NULL，认为匹配成功了，直接获取/admin/index的资源</p>
<p><img src="/imgs/image-20200714215504718.png" alt="image-20200714215504718"></p>
<p>最后梳理下，首先鉴权的时候，匹配规则链doMatch用/进行分隔，/admin/index/和/admin/index效果一样，因为一个以/结尾，一个不以/结尾返回false绕过了鉴权；请求资源的时候，匹配规则链时同样存在问题，getMatchingPattern返回的match不为NULL就判断匹配成功，获取到/admin/index的资源。</p>
<h3 id="CVE-2020-11989分析"><a href="#CVE-2020-11989分析" class="headerlink" title="CVE-2020-11989分析"></a>CVE-2020-11989分析</h3><p>更上面同样的断点，访问 <a href="http://127.0.0.1:8080/;/admin/index" target="_blank" rel="noopener">http://127.0.0.1:8080/;/admin/index</a> ，开始debug</p>
<p>调用getRequestUri(request)，进入该方法</p>
<p><img src="/imgs/image-20200714234621778.png" alt="image-20200714234621778"></p>
<p>获取返回值时，调用decodeAndCleanUriString(request, uri)，分析该方法如图，该方法对含有;的URI进行了处理，当有;时，获取;前的字符串，此时返回/</p>
<p><img src="/imgs/image-20200714235245592.png" alt="image-20200714235245592"></p>
<p>经过normaliz返回/</p>
<p><img src="/imgs/image-20200714235743342.png" alt="image-20200714235743342"></p>
<p>此时请求URI由”/;/admin/index”变成了”/“，然后再去匹配chain规则链就跟之前一样，不能匹配从而绕过鉴权</p>
<p><img src="/imgs/image-20200715000016874.png" alt="image-20200715000016874"></p>
<p>接下来分析是如何获取/admin/index的资源</p>
<p>F8直到org.springframework.web.util.UrlPathHelper#getRequestUri</p>
<p><img src="/imgs/image-20200715000707589.png" alt="image-20200715000707589"></p>
<p>分析 this.decodeAndCleanUriString</p>
<p><img src="/imgs/image-20200715001035983.png" alt="image-20200715001035983"></p>
<p>调用removeSemicolonContent，返回//admin/index</p>
<p><img src="/imgs/image-20200715001526885.png" alt="image-20200715001526885"></p>
<p>继续执行，调用 this.getSanitizedPath</p>
<p><img src="/imgs/image-20200715001735002.png" alt="image-20200715001735002"></p>
<p>经过getSanitizedPath，将//处理成/，最终获取的是/admin/index</p>
<p><img src="/imgs/image-20200715002010255.png" alt="image-20200715002010255"></p>
<p>总结下，首先请求/;/admin/index要先进行鉴权，经过org.apache.shiro.web.util.WebUtils#decodeAndCleanUriString(request, uri)处理成/，绕过了授权，然后请求时再经过org.springframework.web.util.UrlPathHelper#decodeAndCleanUriString获取/admin/index的资源</p>
<p>参考链接：</p>
<p><a href="https://developer.aliyun.com/article/695233" target="_blank" rel="noopener">Spring Boot 2.x基础教程：快速入门</a><br><a href="https://segmentfault.com/a/1190000019440231" target="_blank" rel="noopener">Spring Boot 整合 Shiro ，两种方式全总结！</a><br><a href="https://www.jianshu.com/p/3671b97aab3d" target="_blank" rel="noopener">SpringBoot:集成Shiro之拦截器配置</a><br><a href="https://www.freebuf.com/vuls/231909.html" target="_blank" rel="noopener">Shiro权限绕过漏洞分析（CVE-2020-1957）</a><br><a href="https://xz.aliyun.com/t/7964" target="_blank" rel="noopener">Apache Shiro权限绕过漏洞分析(CVE-2020-11989)</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/download/">Download</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-漏洞信息"><span class="toc-number">1.</span> <span class="toc-text">0x00 漏洞信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-漏洞复现"><span class="toc-number">2.</span> <span class="toc-text">0x01 漏洞复现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境搭建："><span class="toc-number">2.1.</span> <span class="toc-text">环境搭建：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞复现："><span class="toc-number">2.2.</span> <span class="toc-text">漏洞复现：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2020-1957"><span class="toc-number">2.2.1.</span> <span class="toc-text">CVE-2020-1957</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2020-11989"><span class="toc-number">2.2.2.</span> <span class="toc-text">CVE-2020-11989</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-漏洞分析"><span class="toc-number">3.</span> <span class="toc-text">0x02 漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器基础知识"><span class="toc-number">3.1.</span> <span class="toc-text">拦截器基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-1957分析"><span class="toc-number">3.2.</span> <span class="toc-text">CVE-2020-1957分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-11989分析"><span class="toc-number">3.3.</span> <span class="toc-text">CVE-2020-11989分析</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&text=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&is_video=false&description=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析&body=Check out this article: http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&name=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2020/07/10/Apache-Shiro-CVE-2020-1957&amp;CVE-2020-11989%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&t=Apache Shiro CVE-2020-1957&amp;CVE-2020-11989身份认证绕过漏洞分析" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2021
    R17a
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/download/">Download</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?05441306932d71b1dba39f817847ce3e";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


</body>
</html>
